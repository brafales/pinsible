---
templates:
  torrent:
    transmission:
      host: {{ transmission_rpc_host }}
      port: {{ transmission_rpc_port }}
      ratio: {{ min_ratio }}
      username: {{ transmission_rpc_username }}
      password: {{ transmission_rpc_password }}
  tv:
    template: torrent
    metainfo_series: yes
    quality: 720p h264
    exists_series:
      - "{{ transmission_complete_folder }}/{{ series_folder }}"
    include: series.yml
    set:
      path: "{{ transmission_complete_folder }}/{{ series_folder }}/{{ "{{ series_name }}" }}"
      main_file_only: yes
      include_subs: yes
    prowl:
      apikey: "{{ prowl_api_key }}"
      event: "Downloading {{ "{{ series_name }}" }}-{{ "{{ series_id }}" }}"

  anime:
    regexp:
      reject_excluding:
        - HorribleSubs
    template: torrent
    metainfo_series: yes
    quality: 720p
    rss: http://www.nyaa.se/?page=rss&cats=1_37
    exists_series:
      - "{{ transmission_complete_folder }}/{{ series_folder }}"
    include: animes.yml
    set:
      path: {{ transmission_complete_folder }}/{{ series_folder }}/{{ "{{ series_name }}" }}
      main_file_only: yes
      content_filename: "{{ "{{ series_name }}" }} - {{ "{{ series_id }}" }}"
    prowl:
      apikey: "{{ prowl_api_key }}"
      event: "Downloading {{ "{{ series_name }}" }}-{{ "{{ series_id }}" }}"

tasks:
  update_series:
    template: tv
    rss: https://kat.cr/tv/?rss=1

  update_animes:
    template: anime

  remove_old_torrents:
    clean_transmission:
      finished_for: 7 days
      min_ratio: {{ min_ratio }}
      host: {{ transmission_rpc_host }}
      port: {{ transmission_rpc_port }}
      username: {{ transmission_rpc_username }}
      password: {{ transmission_rpc_password }}

  download_subtitles:
    interval: 5 hours
    filesystem:
      path:
        - "{{ transmission_complete_folder }}/{{ series_folder }}"
      regexp: '.*\.(avi|mkv|mp4)$'
      recursive: yes
    accept_all: yes
    disable: seen
    subliminal:
      languages:
        - en
      exact_match: yes
      providers:
        - opensubtitles
        - podnapisi
